#LyX 1.5.3 created this file. For more info see http://www.lyx.org/
\lyxformat 276
\begin_document
\begin_header
\textclass book
\language english
\inputencoding auto
\font_roman default
\font_sans default
\font_typewriter default
\font_default_family default
\font_sc false
\font_osf false
\font_sf_scale 100
\font_tt_scale 100
\graphics default
\paperfontsize default
\spacing single
\papersize default
\use_geometry false
\use_amsmath 1
\use_esint 0
\cite_engine basic
\use_bibtopic false
\paperorientation portrait
\secnumdepth 3
\tocdepth 3
\paragraph_separation skip
\defskip smallskip
\quotes_language english
\papercolumns 1
\papersides 1
\paperpagestyle default
\tracking_changes false
\output_changes false
\author "" 
\author "" 
\end_header

\begin_body

\begin_layout Chapter
Steppers
\end_layout

\begin_layout Standard
If what you get is not what you expect many times you just got some experience.
 Learning from the experience increases your understanding of the whole.
 Diagnosing problems is best done by divide and conquer.
 By this I mean if you can remove 1/2 of the variables from the equation
 each time you will find the problem the fastest.
 In the real world this is not always the case but a good place to start
 usually.
 
\end_layout

\begin_layout Section
Common Problems
\end_layout

\begin_layout Subsection
Stepper Moves One Step
\end_layout

\begin_layout Standard
The most common reason in a new installation for the stepper not to move
 is the step and direction signals are backwards.
 If you press the jog foward and backward key and the stepper moves one
 step each time in the same direction there is your sign.
\end_layout

\begin_layout Subsection
No Steppers Move
\end_layout

\begin_layout Standard
Many drives have an enable pin or need a charge pump to enable the output.
 
\end_layout

\begin_layout Subsection
Distance Not Correct
\end_layout

\begin_layout Standard
If you command the axis to move a specific distance and it does not move
 that distance then your scale is wrong.
\end_layout

\begin_layout Section
Error Messages
\end_layout

\begin_layout Subsection
Following Error
\end_layout

\begin_layout Standard
The concept of a following error is funny when talking about stepper motors.
 Since they are an open loop system, there is no position feedback to let
 you know if you actually are out of range.
 EMC calculates if it can keep up with the motion called for and if not
 then it gives a following error.
 Following errors usually are the result of one of the following on stepper
 systems.
\end_layout

\begin_layout Itemize
FERROR to small
\end_layout

\begin_layout Itemize
MIN_FERROR to small
\end_layout

\begin_layout Itemize
MAX_VELOCITY to fast
\end_layout

\begin_layout Itemize
MAX_ACCELERATION to fast
\end_layout

\begin_layout Itemize
BASE_PERIOD set to long
\end_layout

\begin_layout Itemize
Backlash added to an axis
\end_layout

\begin_layout Standard
Any of the above can cause the RT pulsing to not be able to keep up the
 requested step rate.
 This can happen if you didn't run the latency test long enough to get a
 good number to plug into the Stepconf Wizard or if you set the Maximum
 Velocity or Maximum Acceleration too high.
 
\end_layout

\begin_layout Standard
If you added backlash you need to increase the STEPGEN_MAXACCEL up to double
 the MAX_ACCELERATION in the AXIS section of the INI file for each axis
 you added backlash to.
 EMC uses "extra acceleration" at a reversal to take up the backlash.
 Without backlash correction step generator acceleration can be just a few
 percent above the motion planner acceleration.
\end_layout

\begin_layout Subsection
RTAPI Error
\end_layout

\begin_layout Standard
When you get this error:
\end_layout

\begin_layout Quote
RTAPI: ERROR: Unexpected realtime delay on task n
\end_layout

\begin_layout Standard
This error is generated by rtapi based on an indication from rtai that a
 deadline was missed.
 It is usually an indication that the BASE_PERIOD in the [EMCMOT] section
 of the ini file is set too low.
 You should run the Latency Test for an extended period of time to see if
 you have any delays that would cause this problem.
 If you used the Stepconf Wizard run it again and test the Base Period Jitter
 again and adjust the Base Period Maximum Jitter on the Basic Machine Informatio
n page.
 You might have to leave the test running for an extended period of time
 to find out if some hardware causes intermittent problems.
\end_layout

\begin_layout Standard
EMC2 tracks the number of CPU cycles between invocations of the real-time
 thread.
 If some element of your hardware is causing delays or your realtime threads
 are set too fast you will get this error.
 
\end_layout

\begin_layout Standard
NOTE: This error is only displayed once per session.
 If you had your BASE_PERIOD too low you could get hundreds of thousands
 of error messages per second if more than one was displayed.
\end_layout

\begin_layout Standard

\end_layout

\begin_layout Section
Testing
\end_layout

\begin_layout Subsection
Step Timing
\end_layout

\begin_layout Standard
If you are seeing an axis ending up in the wrong location over multiple
 moves, it is likely that you do not have the correct direction hold times
 or step timing for your stepper drivers.
 Each direction change may be losing a step or more.
 If the motors are stalling, it is also possible you have either the MAX_ACCELER
ATION or MAX_VELOCITY set too high for that axis.
 
\end_layout

\begin_layout Standard
The following program will test the Z axis configuration for proper setup.
 Copy the program to your emc2/nc_files directory and name it TestZ.ngc or
 similar.
 Zero your machine with Z = 0.000 at the table top.
 Load and run the program.
 It will make 200 moves back and forth from 0.5 to 1".
 If you have a configuration issue, you will find that the final position
 will not end up 0.500" that the axis window is showing.
 To test another axis just replace the Z with your axis in the G0 lines.
\end_layout

\begin_layout Quote
( test program to see if Z axis loses position )
\newline
( msg, test 1 of Z axis
 configuration )
\newline
G20 #1000=100 ( loop 100 times )
\newline
( this loop has delays after
 moves )
\newline
( tests acc and velocity settings )
\newline
o100 while [#1000]
\newline
G0 Z1.000
\newline
G4
 P0.250
\newline
G0 Z0.500
\newline
G4 P0.250
\newline
#1000 = [#1000 - 1]
\newline
o100 endwhile
\newline
( msg, test 2 of Z
 axis configuration S to continue)
\newline
M1 (stop here)
\newline
#1000=100 ( loop 100 times
 )
\newline
( the next loop has no delays after moves )
\newline
( tests direction hold times
 on driver config and also max accel setting )
\newline
o101 while [#1000] 
\newline
G0 Z1.000
\newline
G0
 Z0.500
\newline
#1000 = [#1000 - 1]
\newline
o101 endwhile
\newline
( msg, Done...Z should be exactly .5"
 above table )
\newline
M2
\end_layout

\end_body
\end_document
